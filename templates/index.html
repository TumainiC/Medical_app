<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Health Monitoring System - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-blue: #4169E1;
            --heart-red: #FF4757;
            --blood-red: #E74C3C;
            --temp-orange: #FF6B6B;
            --lungs-blue: #5DADE2;
            --success-green: #7FD18C;
            --bg-gradient: linear-gradient(135deg, #E8EEF5 0%, #DFE9F3 100%);
            --card-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.3);
            --text-dark: #2C3E50;
            --text-muted: #7F8C8D;
            --shadow-sm: 0 2px 10px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-dark);
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Glass Card Effect */
        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-md);
            padding: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        /* Header */
        .header {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 24px 32px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--glass-border);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-dark);
            margin: 0;
        }

        .header p {
            color: var(--text-muted);
            margin: 4px 0 0 0;
            font-size: 0.9rem;
        }

        /* Compact Metric Cards */
        .compact-metric {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 16px 20px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }

        .compact-metric:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow-md);
        }

        .compact-metric .icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .metric-info {
            flex: 1;
        }

        .metric-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
            line-height: 1;
        }

        .metric-unit {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 400;
            margin-left: 4px;
        }

        /* Large Feature Cards */
        .feature-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 32px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-md);
            height: 100%;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        /* Status Badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .status-normal {
            background: #E8F8F0;
            color: var(--success-green);
        }

        .status-anomaly {
            background: #FFE5E8;
            color: var(--heart-red);
        }

        .status-normal::before,
        .status-anomaly::before {
            content: '‚Ä¢';
            font-size: 1.2rem;
        }

        /* Steps Counter */
        .steps-counter {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 32px;
        }

        .steps-circle {
            position: relative;
            width: 180px;
            height: 180px;
        }

        .steps-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .steps-value h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin: 0;
            line-height: 1;
        }

        .steps-value p {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin: 4px 0 0 0;
        }

        .steps-goal {
            margin-top: 16px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* Heart Rate Display */
        .heart-display {
            text-align: center;
            padding: 24px;
        }

        .heart-icon-large {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #FF6B6B 0%, #FF4757 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
            color: white;
            box-shadow: 0 10px 40px rgba(255, 71, 87, 0.3);
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            10% { transform: scale(1.05); }
            20% { transform: scale(1); }
        }

        .heart-rate-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .heart-rate-label {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* Chart Container */
        .chart-container {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-sm);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .recommendations {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 28px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-md);
        }

        /* Modern Organ Cards */
        .organ-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .organ-card:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-lg);
        }

        .organ-icon {
            font-size: 4rem;
            margin-bottom: 16px;
            display: block;
        }

        .organ-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .organ-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: var(--success-green);
            font-weight: 600;
        }

        .organ-status::before {
            content: '‚Ä¢';
            font-size: 1.2rem;
        }

        /* AI Insights Styling */
        .ai-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .ai-powered {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .rule-based {
            background: #95A5A6;
            color: white;
        }

        .ai-insight-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid var(--primary-color);
        }

        .ai-insight-section h6 {
            color: var(--primary-color);
            font-weight: bold;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-summary {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            padding: 18px;
            border-radius: 8px;
            font-size: 1.05rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .ai-list {
            list-style: none;
            padding: 0;
        }

        .ai-list li {
            padding: 10px 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 6px;
            border-left: 3px solid var(--primary-color);
            transition: all 0.2s ease;
        }

        .ai-list li:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .ai-list li::before {
            content: "‚úì";
            color: var(--primary-color);
            font-weight: bold;
            margin-right: 10px;
        }

        .encouragement-box {
            background: linear-gradient(135deg, #11998e15 0%, #38ef7d15 100%);
            padding: 18px;
            border-radius: 8px;
            border-left: 4px solid #11998e;
            font-style: italic;
            color: #155724;
            font-size: 1.05rem;
        }

        .alert-box {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
            color: #856404;
        }

        .immediate-action {
            background: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }

        /* Streaming Animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .streaming-indicator {
            animation: pulse 1.5s ease-in-out infinite;
        }

        .loading-spinner {
            text-align: center;
            padding: 50px;
        }

        .user-input {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        /* Modern Buttons */
        .btn-primary {
            background: var(--primary-blue);
            border: none;
            padding: 14px 32px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(65, 105, 225, 0.3);
        }

        .btn-primary:hover {
            background: #3654C9;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(65, 105, 225, 0.4);
        }

        .btn-secondary {
            background: white;
            border: 2px solid var(--glass-border);
            color: var(--text-dark);
            padding: 14px 32px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #F8F9FA;
            border-color: var(--primary-blue);
            color: var(--primary-blue);
        }

        /* User Input Card */
        .user-input {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 28px;
            margin-bottom: 24px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-md);
        }

        .user-input h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-dark);
        }

        .form-control {
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            padding: 12px 16px;
            font-size: 0.95rem;
            background: rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(65, 105, 225, 0.1);
            background: white;
        }

        .form-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        /* Sleep Time Card */
        .sleep-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-sm);
        }

        .sleep-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .sleep-time {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .time-badge {
            display: inline-block;
            background: #2C3E50;
            color: white;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 12px;
        }

        /* Health Score */
        .health-score-circle {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            box-shadow: var(--shadow-md);
            position: relative;
        }

        .score-excellent {
            background: linear-gradient(135deg, #7FD18C 0%, #5FB97C 100%);
        }

        .score-good {
            background: linear-gradient(135deg, #5DADE2 0%, #3498DB 100%);
        }

        .score-fair {
            background: linear-gradient(135deg, #F39C12 0%, #E67E22 100%);
        }

        .score-poor {
            background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%);
        }

        @media (max-width: 768px) {
            .metric-card {
                margin-bottom: 15px;
            }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            min-width: 300px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            border-radius: 10px;
            border: none;
        }

        .toast-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .toast-error {
            background: linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%);
            color: white;
        }

        .toast-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .toast-body {
            padding: 15px;
            font-weight: 500;
        }

        .btn-primary:disabled,
        .btn-secondary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
            border-width: 0.15em;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1><i class="bi bi-heart-pulse"></i> AI Health Monitoring System</h1>
                    <p>Real-time health monitoring with AI-powered anomaly detection</p>
                </div>
                <div class="col-md-4 text-end">
                    <span id="lastUpdate" class="text-muted">Last updated: --26th Nov 2025</span>
                </div>
            </div>
        </div>

        <!-- User Input -->
        <div class="user-input">
            <h4 class="mb-3"><i class="bi bi-person-circle"></i> User Information</h4>
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="userId" class="form-label">User ID</label>
                        <input type="text" class="form-control" id="userId" value="user_001" placeholder="Enter user ID">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="numRecords" class="form-label">Number of Records</label>
                        <input type="number" class="form-control" id="numRecords" value="100" min="10" max="500">
                    </div>
                </div>
            </div>
            <button class="btn btn-primary" id="loadDashboardBtn" onclick="loadDashboard()">
                <i class="bi bi-graph-up"></i> Load Dashboard
            </button>
            <button class="btn btn-secondary" id="simulateRealtimeBtn" onclick="simulateRealtime()">
                <i class="bi bi-activity"></i> Simulate Real-time Data
            </button>
        </div>

        <!-- Toast Notification Container -->
        <div class="toast-container" id="toastContainer"></div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="loading-spinner" style="display:none;">
            <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">Analyzing health data...</p>
        </div>

        <!-- Dashboard Content -->
        <div id="dashboardContent" style="display:none;">
            <!-- AI Recommendations (Top Priority) -->
            <div class="recommendations" style="margin-bottom: 24px;">
                <h4 class="mb-3" style="font-weight: 600; font-size: 1.1rem;">
                    <i class="bi bi-robot"></i> AI Health Insights
                </h4>
                <div id="recommendationsList">
                    <!-- AI Recommendations will be loaded here -->
                </div>
            </div>

            <!-- Main Dashboard Grid -->
            <div class="row g-3">
                <!-- Left Column: Metrics & Info -->
                <div class="col-lg-3">
                    <!-- Compact Weight/Food Cards -->
                    <div class="compact-metric">
                        <div class="icon" style="background: #FFE5E8;">
                            <i class="bi bi-graph-down" style="color: var(--heart-red);"></i>
                        </div>
                        <div class="metric-info">
                            <div class="metric-label">Weight</div>
                            <div class="metric-value">
                                <span id="weightValue">74.2</span>
                                <span class="metric-unit">kg</span>
                            </div>
                        </div>
                    </div>

                    <div class="compact-metric">
                        <div class="icon" style="background: #FFF4E5;">
                            <i class="bi bi-egg-fried" style="color: #FF9800;"></i>
                        </div>
                        <div class="metric-info">
                            <div class="metric-label">Food</div>
                            <div class="metric-value">
                                <span id="caloriesValue">253</span>
                                <span class="metric-unit">kCal</span>
                            </div>
                        </div>
                    </div>

                    <!-- Steps Counter -->
                    <div class="feature-card">
                        <div class="steps-counter">
                            <div class="steps-circle">
                                <svg width="180" height="180">
                                    <circle cx="90" cy="90" r="75" fill="none" stroke="#E8EEF5" stroke-width="12"/>
                                    <circle id="stepsProgress" cx="90" cy="90" r="75" fill="none" 
                                            stroke="url(#blueGradient)" stroke-width="12" 
                                            stroke-linecap="round" 
                                            transform="rotate(-90 90 90)"
                                            stroke-dasharray="471" stroke-dashoffset="200"/>
                                    <defs>
                                        <linearGradient id="blueGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style="stop-color:#4169E1"/>
                                            <stop offset="100%" style="stop-color:#5DADE2"/>
                                        </linearGradient>
                                    </defs>
                                </svg>
                                <div class="steps-value">
                                    <h2 id="stepsCount">7,425</h2>
                                    <p>Steps</p>
                                </div>
                            </div>
                            <div class="steps-goal">10,000 Steps Goal</div>
                        </div>
                    </div>
                </div>

                <!-- Middle Column: Heart Rate & Body -->
                <div class="col-lg-6">
                    <!-- Heart Rate Card -->
                    <div class="feature-card" style="margin-bottom: 16px;">
                        <div class="heart-display">
                            <div class="heart-icon-large">
                                <i class="bi bi-heart-fill"></i>
                            </div>
                            <div class="heart-rate-label">Heart Rate</div>
                            <div class="heart-rate-value">
                                <span id="heartRate">124</span> <span style="font-size: 1.2rem; font-weight: 400;">bpm</span>
                            </div>
                        </div>
                    </div>

                    <!-- Bottom Row: Compact Metrics -->
                    <div class="row g-3">
                        <div class="col-6">
                            <div class="compact-metric">
                                <div class="icon" style="background: #FFE5E8;">
                                    <i class="bi bi-droplet-fill" style="color: var(--blood-red);"></i>
                                </div>
                                <div class="metric-info">
                                    <div class="metric-label">Blood Status</div>
                                    <div class="metric-value">
                                        <span id="bloodOxygen">102</span>
                                        <span class="metric-unit">%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="compact-metric">
                                <div class="icon" style="background: #FFE8E5;">
                                    <i class="bi bi-thermometer-half" style="color: var(--temp-orange);"></i>
                                </div>
                                <div class="metric-info">
                                    <div class="metric-label">Temperature</div>
                                    <div class="metric-value">
                                        <span id="temperature">37.1</span>
                                        <span class="metric-unit">¬∞C</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="compact-metric">
                                <div class="icon" style="background: #E5F4FF;">
                                    <i class="bi bi-heart-pulse" style="color: var(--primary-blue);"></i>
                                </div>
                                <div class="metric-info">
                                    <div class="metric-label">Heart Rate (Alternative)</div>
                                    <div class="metric-value">
                                        <span id="heartRate2">124</span>
                                        <span class="metric-unit">bpm</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="sleep-card">
                                <div class="sleep-label">Sleep time</div>
                                <div class="sleep-time" id="sleepTime">7:30h</div>
                                <span class="time-badge" id="sleepHours">00:30 - 08:00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Body & Organs -->
                <div class="col-lg-3">
                    <!-- Body Illustration Placeholder -->
                    <div class="feature-card" style="text-align: center; padding: 32px 20px; margin-bottom: 16px;">
                        <div style="font-size: 8rem; color: #BDC3C7; margin-bottom: 12px;">
                            <i class="bi bi-person-standing"></i>
                        </div>
                        <div style="font-size: 0.85rem; color: var(--text-muted);">
                            <span id="anomalyBadge" class="status-badge status-normal">
                                <i class="bi bi-check-circle-fill"></i> Normal
                            </span>
                        </div>
                    </div>

                    <!-- Organ Status Cards -->
                    <div class="row g-3">
                        <div class="col-6">
                            <div class="organ-card">
                                <span class="organ-icon">‚ù§Ô∏è</span>
                                <div class="organ-name">Heart</div>
                                <div class="organ-status">Normal</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="organ-card">
                                <span class="organ-icon">ü´Å</span>
                                <div class="organ-name">Lungs</div>
                                <div class="organ-status" id="respirationStatus">Normal</div>
                                <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;">
                                    <span id="respiration">16</span> breaths/min
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="row g-3 mt-3">
                <div class="col-lg-6">
                    <div class="chart-container">
                        <div class="chart-header">
                            <span class="chart-title">
                                <i class="bi bi-activity"></i> Heart Rate Trend
                            </span>
                        </div>
                        <canvas id="heartRateChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chart-container">
                        <div class="chart-header">
                            <span class="chart-title">
                                <i class="bi bi-droplet-fill"></i> Blood Oxygen Trend
                            </span>
                        </div>
                        <canvas id="oxygenChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Health Score & Stats -->
            <div class="row g-3 mt-3">
                <div class="col-lg-4">
                    <div class="feature-card text-center">
                        <h5 style="font-size: 1rem; font-weight: 600; margin-bottom: 20px;">Overall Health Score</h5>
                        <div id="healthScoreCircle" class="health-score-circle score-excellent">
                            <span id="healthScore">--</span>
                        </div>
                        <div style="margin-top: 16px; font-size: 0.9rem; color: var(--text-muted);">
                            <span id="riskBadge" class="status-badge">Low Risk</span>
                        </div>
                    </div>
                </div>
                <div class="col-lg-8">
                    <div class="feature-card">
                        <h5 style="font-size: 1rem; font-weight: 600; margin-bottom: 20px;">
                            <i class="bi bi-graph-up-arrow"></i> Health Score History
                        </h5>
                        <canvas id="healthScoreChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Statistics Card -->
            <div class="row g-3 mt-3">
                <div class="col-12">
                    <div class="feature-card">
                        <h5 style="font-size: 1rem; font-weight: 600; margin-bottom: 20px;">
                            <i class="bi bi-bar-chart-fill"></i> Statistics & Risk Analysis
                        </h5>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="compact-metric">
                                    <div class="icon" style="background: #E5F4FF;">
                                        <i class="bi bi-file-earmark-medical" style="color: var(--primary-blue);"></i>
                                    </div>
                                    <div class="metric-info">
                                        <div class="metric-label">Total Records</div>
                                        <div class="metric-value" id="totalRecords">--</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="compact-metric">
                                    <div class="icon" style="background: #FFE5E8;">
                                        <i class="bi bi-exclamation-triangle-fill" style="color: var(--heart-red);"></i>
                                    </div>
                                    <div class="metric-info">
                                        <div class="metric-label">Anomalies Detected</div>
                                        <div class="metric-value" id="anomalyCount">--</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="compact-metric">
                                    <div class="icon" style="background: #E8F8F0;">
                                        <i class="bi bi-award-fill" style="color: var(--success-green);"></i>
                                    </div>
                                    <div class="metric-info">
                                        <div class="metric-label">Avg Health Score</div>
                                        <div class="metric-value" id="avgHealthScore">--</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4">
                            <canvas id="riskChart" style="max-height: 200px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let heartRateChart, oxygenChart, healthScoreChart, riskChart;

        // Toast notification function
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            
            const toastHTML = `
                <div class="toast toast-${type}" id="${toastId}" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-body">
                        <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info-circle'}"></i>
                        ${message}
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHTML);
            
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement, { delay: 4000 });
            toast.show();
            
            // Remove toast element after it's hidden
            toastElement.addEventListener('hidden.bs.toast', () => {
                toastElement.remove();
            });
        }

        // Disable/enable buttons
        function setButtonLoading(buttonId, isLoading, originalText, loadingText) {
            const button = document.getElementById(buttonId);
            if (isLoading) {
                button.disabled = true;
                button.innerHTML = `
                    <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                    ${loadingText}
                `;
            } else {
                button.disabled = false;
                button.innerHTML = originalText;
            }
        }

        async function loadDashboard() {
            const userId = document.getElementById('userId').value;
            const numRecords = document.getElementById('numRecords').value;

            // Validate inputs
            if (!userId) {
                showToast('Please enter a user ID', 'error');
                return;
            }

            // Disable button and show loading
            setButtonLoading('loadDashboardBtn', true, 
                '<i class="bi bi-graph-up"></i> Load Dashboard', 
                'Loading...');
            
            document.getElementById('loadingSpinner').style.display = 'block';
            document.getElementById('dashboardContent').style.display = 'none';

            try {
                // Step 1: Simulate data
                console.log(`üìä Starting data simulation for user: ${userId}, records: ${numRecords}`);
                showToast(`Generating ${numRecords} health records for ${userId}...`, 'info');
                
                const simulateResponse = await fetch('/api/health/simulate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, num_records: parseInt(numRecords) })
                });

                console.log(`Response status: ${simulateResponse.status}`);
                const simulateData = await simulateResponse.json();
                console.log('Simulation response:', simulateData);
                
                if (!simulateData.success) {
                    throw new Error(simulateData.error || 'Failed to generate data');
                }

                console.log('‚úì Data simulation successful');
                showToast('‚úì Data generated. Loading with AI insights...', 'success');

                // Step 2: Stream dashboard data with AI insights
                console.log(`üìà Streaming dashboard data for user: ${userId}`);
                document.getElementById('loadingSpinner').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';
                
                // Show loading state for recommendations
                const recList = document.getElementById('recommendationsList');
                recList.innerHTML = `
                    <div class="ai-badge ai-powered">
                        <i class="bi bi-robot"></i> AI-Powered Insights Loading...
                    </div>
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3">Analyzing your health data with AI...</p>
                    </div>
                `;
                
                try {
                    await loadDashboardWithStreaming(userId);
                    showToast('‚úì Dashboard loaded with AI insights!', 'success');
                    console.log('‚úì Dashboard streaming complete');
                } catch (streamError) {
                    console.warn('Streaming failed, already handled by fallback');
                }
                
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
                console.error('Dashboard loading error:', error);
                document.getElementById('loadingSpinner').style.display = 'none';
                
                // Show error state in recommendations
                const recList = document.getElementById('recommendationsList');
                recList.innerHTML = `
                    <div class="alert-box immediate-action">
                        <h6><i class="bi bi-exclamation-triangle"></i> Error Loading Data</h6>
                        <p>Unable to load health insights: ${error.message}</p>
                        <p>Please try again or contact support if the issue persists.</p>
                    </div>
                `;
            } finally {
                setButtonLoading('loadDashboardBtn', false, 
                    '<i class="bi bi-graph-up"></i> Load Dashboard', 
                    'Loading...');
            }
        }

        async function loadDashboardWithStreaming(userId) {
            return new Promise((resolve, reject) => {
                const eventSource = new EventSource(`/api/health/dashboard/${userId}/stream`);
                let aiChunks = [];
                let dashboardData = null;
                let timeout;
                
                // Set timeout for streaming
                timeout = setTimeout(() => {
                    console.warn('Streaming timeout, falling back to standard load');
                    eventSource.close();
                    loadDashboardFallback(userId).then(resolve).catch(reject);
                }, 15000); // 15 second timeout
                
                eventSource.addEventListener('message', (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        console.log('Received event:', data.type);
                    
                    if (data.type === 'metrics') {
                        // Update dashboard metrics immediately
                        dashboardData = data.data;
                        updateDashboardMetrics(dashboardData);
                    } else if (data.type === 'ai_start') {
                        // AI streaming started
                        const recList = document.getElementById('recommendationsList');
                        recList.innerHTML = `
                            <div class="ai-badge ai-powered">
                                <i class="bi bi-robot"></i> AI-Powered Insights by Gemini
                            </div>
                            <div class="ai-summary" id="streamingContent" style="white-space: pre-wrap; line-height: 1.8;">
                                <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                                Generating insights...
                            </div>
                        `;
                    } else if (data.type === 'ai_chunk') {
                        // Accumulate and display AI chunks in real-time
                        aiChunks.push(data.chunk);
                        const streamingContent = document.getElementById('streamingContent');
                        if (streamingContent) {
                            // Convert markdown-style headers to HTML and display
                            const formattedText = formatStreamingText(aiChunks.join(''));
                            streamingContent.innerHTML = formattedText;
                        }
                    } else if (data.type === 'ai_complete') {
                        // Finalize the display
                        const completeText = aiChunks.join('');
                        const recList = document.getElementById('recommendationsList');
                        recList.innerHTML = `
                            <div class="ai-badge ai-powered">
                                <i class="bi bi-robot"></i> AI-Powered Insights by Gemini
                            </div>
                            <div class="ai-summary" style="line-height: 1.8;">
                                ${formatStreamingText(completeText)}
                            </div>
                        `;
                    } else if (data.type === 'fallback') {
                        // Display rule-based recommendations
                        displayFallbackRecommendations(data.recommendations);
                    } else if (data.type === 'complete') {
                        // Streaming complete
                        clearTimeout(timeout);
                        eventSource.close();
                        resolve();
                    } else if (data.type === 'error') {
                        console.error('Streaming error:', data.error);
                        showToast('Streaming failed, using fallback mode', 'error');
                        clearTimeout(timeout);
                        eventSource.close();
                        loadDashboardFallback(userId).then(resolve).catch(reject);
                    }
                } catch (e) {
                    console.error('Error processing event:', e);
                    showToast('Error processing data: ' + e.message, 'error');
                }
            });
            
            eventSource.addEventListener('error', (error) => {
                console.error('EventSource error:', error);
                clearTimeout(timeout);
                eventSource.close();
                showToast('Connection error, loading with standard method', 'info');
                loadDashboardFallback(userId).then(resolve).catch(reject);
            });
        });
        }
        
        async function loadDashboardFallback(userId) {
            console.log('üìà Loading dashboard with standard method (fallback)');
            try {
                const response = await fetch(`/api/health/dashboard/${userId}`);
                const data = await response.json();
                
                if (data.success) {
                    updateDashboardMetrics(data.dashboard);
                    
                    if (data.dashboard.using_ai && data.dashboard.ai_insights) {
                        displayAIInsights(data.dashboard.ai_insights, true);
                    } else {
                        displayFallbackRecommendations(data.dashboard.recommendations);
                    }
                    
                    return data.dashboard;
                } else {
                    throw new Error(data.error || 'Failed to load dashboard');
                }
            } catch (error) {
                console.error('Fallback loading error:', error);
                throw error;
            }
        }

        function formatStreamingText(text) {
            // Convert markdown-style formatting to HTML for better readability
            let formatted = text
                // First, convert line breaks to preserve structure
                .replace(/\n\n/g, '|||DOUBLE_BR|||')
                .replace(/\n/g, '|||SINGLE_BR|||')
                // Convert ## headers to bold headers with spacing (includes the line break)
                .replace(/## ([A-Z\s]+)(\|\|\|SINGLE_BR\|\|\|)?/g, '<div style="display: block; margin-top: 20px; margin-bottom: 10px; font-weight: 700; font-size: 1.1em; color: #2c3e50;">$1</div>')
                // Convert bullet points (‚Ä¢) to styled list items
                .replace(/‚Ä¢ (.+?)(\|\|\|SINGLE_BR\|\|\|)/g, '<div style="margin-left: 20px; margin-bottom: 8px; font-weight: normal; color: #34495e;">‚Ä¢ $1</div>')
                // Restore line breaks
                .replace(/\|\|\|DOUBLE_BR\|\|\|/g, '<br><br>')
                .replace(/\|\|\|SINGLE_BR\|\|\|/g, '<br>');
            
            return formatted;
        }
        
        function updateDashboardMetrics(data) {
            // Update all heart rate displays
            const heartRate = data.current_metrics.heart_rate;
            document.getElementById('heartRate').textContent = heartRate;
            if (document.getElementById('heartRate2')) {
                document.getElementById('heartRate2').textContent = heartRate;
            }
            
            // Update blood oxygen
            document.getElementById('bloodOxygen').textContent = data.current_metrics.blood_oxygen;
            
            // Update temperature
            document.getElementById('temperature').textContent = data.current_metrics.temperature.toFixed(1);
            
            // Update respiration
            document.getElementById('respiration').textContent = data.current_metrics.respiration_rate;

            // Update steps counter (simulated based on activity)
            const steps = Math.floor(data.current_metrics.health_score * 100);
            document.getElementById('stepsCount').textContent = steps.toLocaleString();
            
            // Update steps progress circle
            const stepsProgress = (steps / 10000) * 471; // 471 is circumference of circle
            const dashOffset = 471 - stepsProgress;
            document.getElementById('stepsProgress').style.strokeDashoffset = dashOffset;

            // Update health score
            const healthScore = data.current_metrics.health_score;
            document.getElementById('healthScore').textContent = healthScore;
            
            const scoreCircle = document.getElementById('healthScoreCircle');
            scoreCircle.className = 'health-score-circle';
            if (healthScore >= 80) scoreCircle.classList.add('score-excellent');
            else if (healthScore >= 60) scoreCircle.classList.add('score-good');
            else if (healthScore >= 40) scoreCircle.classList.add('score-fair');
            else scoreCircle.classList.add('score-poor');

            // Update status badges with icons
            const anomalyBadge = document.getElementById('anomalyBadge');
            const isNormal = data.status.anomaly === 'Normal';
            anomalyBadge.innerHTML = `
                <i class="bi bi-${isNormal ? 'check-circle-fill' : 'exclamation-triangle-fill'}"></i> 
                ${data.status.anomaly}
            `;
            anomalyBadge.className = 'status-badge ' + 
                (isNormal ? 'status-normal' : 'status-anomaly');

            const riskBadge = document.getElementById('riskBadge');
            riskBadge.textContent = data.status.risk_level;
            riskBadge.className = 'status-badge';
            if (data.status.risk_level === 'Low Risk') {
                riskBadge.classList.add('status-normal');
            } else if (data.status.risk_level === 'Medium Risk') {
                riskBadge.style.background = '#FFF4E5';
                riskBadge.style.color = '#FF9800';
            } else {
                riskBadge.classList.add('status-anomaly');
            }

            // Update organ status
            const respirationStatus = document.getElementById('respirationStatus');
            if (data.current_metrics.respiration_rate >= 12 && data.current_metrics.respiration_rate <= 20) {
                respirationStatus.textContent = 'Normal';
                respirationStatus.style.color = 'var(--success-green)';
            } else {
                respirationStatus.textContent = 'Alert';
                respirationStatus.style.color = 'var(--heart-red)';
            }

            // Update statistics
            document.getElementById('totalRecords').textContent = data.statistics.total_records;
            document.getElementById('anomalyCount').textContent = data.statistics.anomaly_count;
            document.getElementById('avgHealthScore').textContent = data.statistics.avg_health_score.toFixed(1);

            // Update charts
            updateCharts(data.trends, data.statistics.risk_distribution);
        }

        function displayAIInsights(insights, usingAI) {
            const recList = document.getElementById('recommendationsList');
            
            recList.innerHTML = `
                <!-- AI Badge -->
                <div class="ai-badge ${usingAI ? 'ai-powered' : 'rule-based'}">
                    <i class="bi bi-${usingAI ? 'robot' : 'gear'}"></i> ${usingAI ? 'AI-Powered Insights by Gemini' : 'Rule-Based Recommendations'}
                </div>
                
                <!-- Summary -->
                ${insights.summary ? `
                    <div class="ai-summary">
                        <strong><i class="bi bi-lightbulb-fill"></i> Summary:</strong><br>
                        ${insights.summary}
                    </div>
                ` : ''}
                
                <!-- Key Findings -->
                ${insights.key_findings && insights.key_findings.length > 0 ? `
                    <div class="ai-insight-section">
                        <h6><i class="bi bi-search"></i> Key Findings</h6>
                        <ul class="ai-list">
                            ${insights.key_findings.map(finding => `<li>${finding}</li>`).join('')}
                        </ul>
                    </div>
                ` : ''}
                
                <!-- Immediate Actions (if any) -->
                ${insights.immediate_actions && insights.immediate_actions.length > 0 ? `
                    <div class="ai-insight-section immediate-action alert-box">
                        <h6><i class="bi bi-exclamation-triangle-fill"></i> Immediate Actions Required</h6>
                        <ul class="ai-list">
                            ${insights.immediate_actions.map(action => `<li>${action}</li>`).join('')}
                        </ul>
                    </div>
                ` : ''}
                
                <!-- Recommendations -->
                ${insights.recommendations && insights.recommendations.length > 0 ? `
                    <div class="ai-insight-section">
                        <h6><i class="bi bi-clipboard-check"></i> Personalized Recommendations</h6>
                        <ul class="ai-list">
                            ${insights.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>
                ` : ''}
                
                <!-- Lifestyle Tips -->
                ${insights.lifestyle_tips && insights.lifestyle_tips.length > 0 ? `
                    <div class="ai-insight-section">
                        <h6><i class="bi bi-heart-fill"></i> Lifestyle Tips</h6>
                        <ul class="ai-list">
                            ${insights.lifestyle_tips.map(tip => `<li>${tip}</li>`).join('')}
                        </ul>
                    </div>
                ` : ''}
                
                <!-- Monitoring Advice -->
                ${insights.monitoring_advice ? `
                    <div class="ai-insight-section">
                        <h6><i class="bi bi-eye-fill"></i> Monitoring Advice</h6>
                        <p>${insights.monitoring_advice}</p>
                    </div>
                ` : ''}
                
                <!-- When to Seek Help -->
                ${insights.when_to_seek_help ? `
                    <div class="ai-insight-section alert-box">
                        <h6><i class="bi bi-hospital"></i> When to Seek Medical Help</h6>
                        <p>${insights.when_to_seek_help}</p>
                    </div>
                ` : ''}
                
                <!-- Encouragement -->
                ${insights.encouragement ? `
                    <div class="encouragement-box">
                        <i class="bi bi-emoji-smile-fill"></i> ${insights.encouragement}
                    </div>
                ` : ''}
            `;
        }

        function displayFallbackRecommendations(recommendations) {
            const recList = document.getElementById('recommendationsList');
            recList.innerHTML = `
                <div class="ai-badge rule-based">
                    <i class="bi bi-gear"></i> Rule-Based Recommendations
                </div>
                ${recommendations.map(rec => 
                    `<div class="recommendation-item">${rec}</div>`
                ).join('')}
            `;
        }

        function updateDashboard(dashboard) {
            // Update current metrics
            document.getElementById('heartRate').textContent = dashboard.current_metrics.heart_rate;
            document.getElementById('bloodOxygen').textContent = dashboard.current_metrics.blood_oxygen;
            document.getElementById('temperature').textContent = dashboard.current_metrics.temperature.toFixed(1);
            document.getElementById('respiration').textContent = dashboard.current_metrics.respiration_rate;

            // Update health score
            const healthScore = dashboard.current_metrics.health_score;
            document.getElementById('healthScore').textContent = healthScore;
            
            const scoreCircle = document.getElementById('healthScoreCircle');
            scoreCircle.className = 'health-score-circle';
            if (healthScore >= 80) scoreCircle.classList.add('score-excellent');
            else if (healthScore >= 60) scoreCircle.classList.add('score-good');
            else if (healthScore >= 40) scoreCircle.classList.add('score-fair');
            else scoreCircle.classList.add('score-poor');

            // Update status badges
            const anomalyBadge = document.getElementById('anomalyBadge');
            anomalyBadge.textContent = dashboard.status.anomaly;
            anomalyBadge.className = 'status-badge ' + 
                (dashboard.status.anomaly === 'Normal' ? 'status-normal' : 'status-anomaly');

            const riskBadge = document.getElementById('riskBadge');
            riskBadge.textContent = dashboard.status.risk_level;
            riskBadge.className = 'status-badge';
            if (dashboard.status.risk_level === 'Low Risk') riskBadge.classList.add('risk-low');
            else if (dashboard.status.risk_level === 'Medium Risk') riskBadge.classList.add('risk-medium');
            else riskBadge.classList.add('risk-high');

            // Update statistics
            document.getElementById('totalRecords').textContent = dashboard.statistics.total_records;
            document.getElementById('anomalyCount').textContent = dashboard.statistics.anomaly_count;
            document.getElementById('avgHealthScore').textContent = dashboard.statistics.avg_health_score.toFixed(1);

            // Update charts
            updateCharts(dashboard.trends, dashboard.statistics.risk_distribution);

            // Update recommendations with AI insights
            if (dashboard.using_ai && dashboard.ai_insights) {
                displayAIInsights(dashboard.ai_insights, true);
            } else {
                displayFallbackRecommendations(dashboard.recommendations);
            }

            // Update timestamp
            document.getElementById('lastUpdate').textContent = 
                'Last updated: ' + new Date(dashboard.last_updated).toLocaleString();
        }

        function updateCharts(trends, riskDist) {
            const labels = trends.timestamps.map((t, i) => `T${i+1}`);

            // Heart Rate Chart
            const hrCtx = document.getElementById('heartRateChart').getContext('2d');
            if (heartRateChart) heartRateChart.destroy();
            heartRateChart = new Chart(hrCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Heart Rate (bpm)',
                        data: trends.heart_rate,
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: false, min: 50, max: 120 }
                    }
                }
            });

            // Oxygen Chart
            const o2Ctx = document.getElementById('oxygenChart').getContext('2d');
            if (oxygenChart) oxygenChart.destroy();
            oxygenChart = new Chart(o2Ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Blood Oxygen (%)',
                        data: trends.blood_oxygen,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: false, min: 85, max: 100 }
                    }
                }
            });

            // Health Score Chart
            const hsCtx = document.getElementById('healthScoreChart').getContext('2d');
            if (healthScoreChart) healthScoreChart.destroy();
            healthScoreChart = new Chart(hsCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Health Score',
                        data: trends.health_score,
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: false, min: 0, max: 100 }
                    }
                }
            });

            // Risk Distribution Chart
            const riskCtx = document.getElementById('riskChart').getContext('2d');
            if (riskChart) riskChart.destroy();
            riskChart = new Chart(riskCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(riskDist),
                    datasets: [{
                        data: Object.values(riskDist),
                        backgroundColor: ['#28a745', '#ffc107', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        async function simulateRealtime() {
            const userId = document.getElementById('userId').value;
            
            // Validate input
            if (!userId) {
                showToast('Please enter a user ID', 'error');
                return;
            }

            // Disable button and show loading
            setButtonLoading('simulateRealtimeBtn', true,
                '<i class="bi bi-activity"></i> Simulate Real-time Data',
                'Analyzing...');

            const realtimeData = {
                user_id: userId,
                heart_rate: Math.floor(Math.random() * 40) + 60,
                blood_oxygen: Math.floor(Math.random() * 10) + 90,
                temperature: parseFloat((Math.random() * 2 + 35.5).toFixed(1)),
                respiration_rate: Math.floor(Math.random() * 8) + 12,
                activity_level: ['low', 'moderate', 'high'][Math.floor(Math.random() * 3)],
                steps: Math.floor(Math.random() * 100),
                sleep_quality: ['poor', 'fair', 'good', 'excellent'][Math.floor(Math.random() * 4)]
            };

            console.log('üî¨ Starting real-time analysis...');
            console.log('Real-time data:', realtimeData);
            showToast('Analyzing health data...', 'info');

            try {
                const response = await fetch('/api/health/realtime', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(realtimeData)
                });

                console.log(`Real-time response status: ${response.status}`);
                const data = await response.json();
                console.log('Real-time analysis result:', data);
                
                if (data.success) {
                    showToast('‚úì Analysis complete!', 'success');
                    
                    // Create a more attractive result display
                    const resultHTML = `
                        <div style="font-size: 14px; line-height: 1.8;">
                            <h5 style="color: white; margin-bottom: 15px;">üìä Real-time Analysis Results</h5>
                            <div><strong>Health Score:</strong> ${data.analysis.health_score}/100</div>
                            <div><strong>Status:</strong> ${data.analysis.anomaly_status}</div>
                            <div><strong>Risk Level:</strong> ${data.analysis.risk_level}</div>
                            <hr style="border-color: rgba(255,255,255,0.3); margin: 10px 0;">
                            <div><strong>Metrics:</strong></div>
                            <div>‚ù§Ô∏è Heart Rate: ${data.metrics.heart_rate} bpm</div>
                            <div>üíß Blood Oxygen: ${data.metrics.blood_oxygen}%</div>
                            <div>üå°Ô∏è Temperature: ${data.metrics.temperature}¬∞C</div>
                            ${data.recommendations && data.recommendations.length > 0 ? 
                                '<hr style="border-color: rgba(255,255,255,0.3); margin: 10px 0;"><div><strong>Top Recommendation:</strong><br>' + 
                                data.recommendations[0] + '</div>' : ''}
                        </div>
                    `;
                    
                    // Show detailed result in a modal-like toast
                    const toastContainer = document.getElementById('toastContainer');
                    const resultToastId = 'result-toast-' + Date.now();
                    
                    const toastHTML = `
                        <div class="toast toast-info" id="${resultToastId}" role="alert" style="min-width: 400px;">
                            <div class="toast-body">
                                ${resultHTML}
                                <button type="button" class="btn btn-sm btn-light mt-2" onclick="document.getElementById('${resultToastId}').remove()">
                                    Close
                                </button>
                            </div>
                        </div>
                    `;
                    
                    toastContainer.insertAdjacentHTML('beforeend', toastHTML);
                    const toastElement = document.getElementById(resultToastId);
                    const toast = new bootstrap.Toast(toastElement, { autohide: false });
                    toast.show();
                } else {
                    throw new Error(data.error || 'Analysis failed');
                }
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
                console.error('Real-time analysis error:', error);
            } finally {
                setButtonLoading('simulateRealtimeBtn', false,
                    '<i class="bi bi-activity"></i> Simulate Real-time Data',
                    'Analyzing...');
            }
        }

        // Load dashboard on page load
        window.onload = function() {
            // Optional: Auto-load dashboard
            // loadDashboard();
        };
    </script>
</body>
</html>
